# Pixivでブックマークしたイラストを自動保存するツール
　[Pixiv](https://www.pixiv.net/)のイラストを保存する場合などはPixiv非公式APIの[PixivPy](https://github.com/upbit/pixivpy)を使うと思いますが，このツールでは[Puppeteer](https://github.com/puppeteer/puppeteer)によるブラウザの自動制御でイラストの保存を行います．保存対象は**ユーザがPixivでブックマークしたイラスト**のため，本ツール使用時には**Pixivアカウントが必要**です．動作確認はWindowsでは確認しましたが，Mac，Linuxでは確認していません．
## 導入
```bash
# 本リポジトリのクローン
git clone https://github.com/devepolian/pixiv_auto_saving.git

# 必要なモジュールのインストール
npm install
```

## 使い方
### 1. （初回のみ）ログイン情報の保存
　`save-new-cookie.js`を実行します．  
```bash
node save-new-cookie.js

#Check exist directory: ./cookie/
#Exist directory: ./cookie/
#Launch Chromium...

#~~~~コマンド一覧~~~~
#login  保存されたログイン情報を用いてログイン
#save   ログイン情報の保存
#finish 本プログラムの終了
#~~~~~~~~~~~~~~~~~~~~

#現在立ち上げたブラウザでログインしてください
#ログイン後はブラウザを閉じずに，以下に"save"と打ち込んでください
>>
```
　`save-new-cookie.js`を実行するとブラウザが立ち上がるので，そのブラウザでPixivにログインしてください．ログイン後はプロンプト・シェルで`save`と打ち込むと，Pixivのログイン済み状態（cookie）をjsonで保存します．

### 2. 自動保存ツール本体の起動
　`auto-save-illust.js`もしくは，`start.bat`を実行します．
```bash
# エラーが出ると終了します
node auto-save-illust.js

# エラーが出ると，上記コマンドを再実行します
start.bat
```
　上記プログラム実行後は，ログインしたユーザのブックマークページをもとにイラストが自動で保存されていきます．

- ####  `auto-save-illust.js`
　イラストの自動保存を行うプログラム本体．エラーが起きると終了コード1で終了する．

  ##### 大まかな流れ
  1. ログイン処理
  2. ユーザのブックマークページへ移動
  3. ブックマークページ内に表示されているイラストを保存
  4. 次のブックマークページへ移動し，再び3を実行する

  ##### ヘッドレスモードの切り替え
  　Puppeteerのデフォルト設定ではブラウザを表示せずに起動します（ヘッドレスモード）．ブラウザの自動制御中の様子を見たい場合には，ヘッドレスモードをOFFにします．
  ```js
  // auto-save-illust.js（4行目）
  // ヘッドレスモードオン
  const HEADLESS_MODE = true;
  // ヘッドレスモードオフ（ブラウザ表示）
  const HEADLESS_MODE = false;
  ```

- ####  `start.bat`
  　`auto-save-illust.js`を実行し，終了コードが1の場合は再び`auto-save-illust.js`を実行するバッチファイル．正常終了するまで，イラスト保存をし続ける．

## おわりに
　元々，ブックマークしたイラストを**右クリックして名前を付けて保存，右クリックして名前を付けて保存，右クリックして名前を付けて保存...**と手動で行っていました．だんだんとブックマークイラストが増えていくにつれて時間が足りなくなってきたため，本ツールの作成に至りました．このツールを実際に使ったことで保存にかかる時間がなくなったため大幅な時間削減になり，自動化による時間削減のメリットを身をもって感じられたと思います．<br>
　とは言っても，もっとスマートな方法（PixivPyなど）があると思います．しかしながら，ブラウザが勝手に動いているのは見てて楽しいので，これはこれで作ってよかったです😊．せっかく作ったので，公式APIや非公式APIが用意されてないようなサイトのスクレイピングを行いたい時が来た時，この経験が生きるといいです．
